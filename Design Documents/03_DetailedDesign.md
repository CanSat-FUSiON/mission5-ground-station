# 地上局システム 詳細設計

基本設計を基に,分割した機能をどのように実装したのか,実装した結果どのようになったのかを示す.

## 技術選定
- `テレメトリ可視化機能およびデータベース`
    - `SLIM`のテレメトリの可視化を参考に決定
        - 可視化ソフト`Grafana` + 時系列DB`InfluxDB`
            - Grafanaはデータ可視化のための強力なツールであり,データの表示手法や,表示のタイムスケールなどを調整することができる.
            - InfluxDBは時系列データベースであり,CanSatのGNCのような時系列が重要なデータを保存するのに適している.PythonでInfluxDBに対して操作を行えるライブラリがあったことも,これを選定する大きな理由となった.
- `ComPortインタフェース`
    - 多くの学部生が触れる機会を考慮して選定
        - `Python`

## システム構成図
詳細設計に基づくシステム構成図を示す。

![](fig/fig2.png)

以上の構成で要件定義を満たしているか確認する.

### `CanSatの標準となるような地上局`
- 多くのチームに採用されやすい
     - 環境構築が楽
        - 移植性が高いこと
        - 環境固有の部分とそうでない部分に明確に分割
            - PC環境やプロジェクトなど環境に固有な部分と,そうでない様々なプロジェクト共通である「可視化機能」は分割した.また,共通化できる部分に関しては移植性が高く作られているため,これらの要件は満たされると考えている.

### `CanSatの底上げ&敷居下げ`
- 拡張性高が高い設計にして高度または独自のミッションに対応
    - `拡張性が高い`
        - 環境固有でない部分はAWS等のクラウドサービスにデプロイ可能
        - 理論上は可能であることからこの要件は達成されているものと考える.
            - 環境固有である部分
                - COM Portからのテレメトリ受信
                - 受信したテレメトリデータをDBに送信
            - これらはHostOS側で実装しているため達成されていると考える.
        - プロジェクト固有の仕様とそうでない部分が分離している
            - プロジェクト固有の仕様
                - テレメトリデータの内容
                - 通信プロトコル
            - これらに関しては,無線機でクッションする形式を考えており,地上局システムと分離していることからこれは達成していると考えてよい.
        - Mission5では想定していないミッションおよびデータを可視化
            - コマンド&テレメトリを柔軟に変更可能(開発途上段階にも便利)
            - 現状想定していないデータの処理が可能(`高度または独自のミッションに対応`)
                - COMPortからのJSONデータをそのまま時系列データに放り投げればよいので,ラフにテレメトリの内容を変化しても問題ないようにできている.
                - また,現状想定していないデータに関しても同様に時系列データベースに入ってさえしまえばGrafanaの裁量次第では可視化ができるものであると考えている.
                - 上記の対応でどうにもならない場合は,HostOS側で処理を書くものとする.

## Grafanaによるデータの可視化
実際のCanSatテレメトリの可視化例を示す。

![](fig/fig3.png)